<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›†æˆæµ‹è¯•</title>
</head>
<body>
    <h1>NOW åº”ç”¨é›†æˆæµ‹è¯•</h1>
    <div id="results"></div>

    <script src="hangzhou-data-config.js"></script>
    <script src="rank-system.js"></script>
    <script src="lifestyle-data.js"></script>
    <script>
        const results = document.getElementById('results');
        let testsPassed = 0;
        let testsFailed = 0;

        function test(name, fn) {
            try {
                fn();
                results.innerHTML += `<p style="color: green;">âœ“ ${name}</p>`;
                testsPassed++;
            } catch (error) {
                results.innerHTML += `<p style="color: red;">âœ— ${name}: ${error.message}</p>`;
                testsFailed++;
            }
        }

        // æµ‹è¯•é…ç½®æ–‡ä»¶
        test('é…ç½®æ–‡ä»¶å·²åŠ è½½', () => {
            if (typeof hangzhouDataConfig === 'undefined') {
                throw new Error('hangzhouDataConfig æœªå®šä¹‰');
            }
        });

        test('é…ç½®æ–‡ä»¶åŒ…å«è–ªèµ„å‚è€ƒæ•°æ®', () => {
            if (!hangzhouDataConfig.salaryReference) {
                throw new Error('ç¼ºå°‘ salaryReference');
            }
            if (hangzhouDataConfig.salaryReference.average !== 11000) {
                throw new Error('å¹³å‡å·¥èµ„æ•°æ®ä¸æ­£ç¡®');
            }
        });

        test('é…ç½®æ–‡ä»¶åŒ…å«8ä¸ªæ®µä½', () => {
            if (hangzhouDataConfig.rankTiers.length !== 8) {
                throw new Error(`æ®µä½æ•°é‡é”™è¯¯: ${hangzhouDataConfig.rankTiers.length}`);
            }
        });

        // æµ‹è¯•æ®µä½ç³»ç»Ÿ
        test('æ®µä½ç³»ç»Ÿå·²åŠ è½½', () => {
            if (typeof rankSystem === 'undefined') {
                throw new Error('rankSystem æœªå®šä¹‰');
            }
        });

        test('getRank å‡½æ•°æ­£å¸¸å·¥ä½œ', () => {
            const rank = rankSystem.getRank(10000);
            if (!rank || !rank.name) {
                throw new Error('getRank è¿”å›å€¼æ— æ•ˆ');
            }
            if (rank.name !== 'é»„é‡‘') {
                throw new Error(`10000å…ƒåº”è¯¥æ˜¯é»„é‡‘æ®µä½ï¼Œå®é™…æ˜¯: ${rank.name}`);
            }
        });

        test('getRankInfo å‡½æ•°æ­£å¸¸å·¥ä½œ', () => {
            const info = rankSystem.getRankInfo(10000);
            if (!info || !info.current) {
                throw new Error('getRankInfo è¿”å›å€¼æ— æ•ˆ');
            }
        });

        test('getSavingsRateRecommendation å‡½æ•°æ­£å¸¸å·¥ä½œ', () => {
            const recommendation = rankSystem.getSavingsRateRecommendation(10000);
            if (!recommendation || typeof recommendation.recommended !== 'number') {
                throw new Error('getSavingsRateRecommendation è¿”å›å€¼æ— æ•ˆ');
            }
        });

        // æµ‹è¯•ç”Ÿæ´»æ°´å¹³è®¡ç®—
        test('ç”Ÿæ´»æ°´å¹³è®¡ç®—å·²åŠ è½½', () => {
            if (typeof lifestyleData === 'undefined') {
                throw new Error('lifestyleData æœªå®šä¹‰');
            }
        });

        test('calculate å‡½æ•°æ­£å¸¸å·¥ä½œ', () => {
            const result = lifestyleData.calculate(10000, 1, null, null, 30);
            if (!result || !Array.isArray(result)) {
                throw new Error('calculate è¿”å›å€¼æ— æ•ˆ');
            }
            if (result.length === 0) {
                throw new Error('calculate è¿”å›ç©ºæ•°ç»„');
            }
        });

        test('è¾“å…¥éªŒè¯æ­£å¸¸å·¥ä½œ', () => {
            try {
                lifestyleData.validateSalary(-1000);
                throw new Error('åº”è¯¥æŠ›å‡ºé”™è¯¯');
            } catch (error) {
                if (!error.message.includes('è´Ÿæ•°')) {
                    throw new Error('é”™è¯¯æ¶ˆæ¯ä¸æ­£ç¡®');
                }
            }
        });

        test('getLifestyle å‡½æ•°æ­£å¸¸å·¥ä½œ', () => {
            const result = lifestyleData.getLifestyle(10000);
            if (!result || !Array.isArray(result)) {
                throw new Error('getLifestyle è¿”å›å€¼æ— æ•ˆ');
            }
        });

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        results.innerHTML += `<hr><h2>æµ‹è¯•ç»“æœ</h2>`;
        results.innerHTML += `<p><strong>é€šè¿‡: ${testsPassed}</strong></p>`;
        results.innerHTML += `<p><strong>å¤±è´¥: ${testsFailed}</strong></p>`;
        
        if (testsFailed === 0) {
            results.innerHTML += `<p style="color: green; font-size: 20px;">ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</p>`;
        } else {
            results.innerHTML += `<p style="color: red; font-size: 20px;">âŒ æœ‰æµ‹è¯•å¤±è´¥</p>`;
        }
    </script>
</body>
</html>
